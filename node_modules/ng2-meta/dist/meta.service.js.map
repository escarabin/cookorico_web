{"version":3,"file":"meta.service.js","sourceRoot":"","sources":["../src/meta.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Inject, Injectable, Optional } from '@angular/core';\nimport { Title } from '@angular/platform-browser';\nimport { DOCUMENT } from '@angular/platform-browser';\nimport {Router, NavigationEnd, ActivatedRoute, PRIMARY_OUTLET} from '@angular/router';\nimport {Subscription} from 'rxjs/Subscription';\nimport 'rxjs/add/operator/filter';\nconst isDefined = (val: any) => typeof val !== 'undefined';\n\nexport class MetaConfig {\n\n  useTitleSuffix: boolean = false;\n  defaults: any = {};\n\n  constructor(config?: any) {\n    if (config) {\n      this.useTitleSuffix = isDefined(config.useTitleSuffix) ? config.useTitleSuffix : false;\n      this.defaults = config.defaults || {};\n    }\n  }\n}\n\n@Injectable()\nexport class MetaService {\n  sub: Subscription;\n  headElement: HTMLElement;\n\n  constructor(private titleService: Title, @Inject(DOCUMENT) private document,\n  private router: Router, private activatedRoute: ActivatedRoute,\n  @Inject('meta.config') @Optional() private metaConfig: MetaConfig = new MetaConfig()) {\n    this.metaConfig = metaConfig || new MetaConfig();\n    this.headElement = this.document.querySelector('head');\n    // Credit: https://github.com/angular/angular/issues/9662#issuecomment-229058750\n    this.sub = this.router.events\n    .filter(event => (event instanceof NavigationEnd))\n    .map(_ => this.router.routerState)\n    .map(state => {\n      let route = this.activatedRoute;\n      while (state.firstChild(route)) {\n        route = state.firstChild(route);\n      }\n      return route;\n    })\n    .filter(route => route.outlet === PRIMARY_OUTLET)\n    .flatMap(route => route.data)\n    .subscribe( (data: any) => {\n      this._updateMetaTags(data.meta);\n    });\n  }\n\n  private _getOrCreateMetaTag(name: string): HTMLElement {\n    let el: HTMLElement = this.document.querySelector('meta[name=\\'' + name + '\\']');\n    if (!el) {\n      el = this.document.createElement('meta');\n      el.setAttribute('name', name);\n      this.headElement.appendChild(el);\n    }\n    return el;\n  }\n\n  private _updateMetaTags(meta: any = {}) {\n\n    if (meta.disableUpdate) {\n      return false;\n    }\n\n    this.setTitle(meta.title, meta.titleSuffix);\n\n    Object.keys(meta).forEach(key => {\n      if (key === 'title' || key === 'titleSuffix') {\n        return;\n      }\n      this.setTag(key, meta[key]);\n    });\n\n    Object.keys(this.metaConfig.defaults).forEach(key => {\n      if ( key in meta || key === 'title' || key === 'titleSuffix') {\n        return;\n      }\n      this.setTag(key, this.metaConfig.defaults[key]);\n    });\n  }\n\n  setTitle(title?: string, titleSuffix?: string) {\n    const titleElement = this._getOrCreateMetaTag('title');\n    const ogTitleElement = this._getOrCreateMetaTag('og:title');\n    let titleStr = isDefined(title) ? title : (this.metaConfig.defaults.title || '');\n    if (this.metaConfig.useTitleSuffix) {\n      titleStr += isDefined(titleSuffix) ? titleSuffix : (this.metaConfig.defaults.titleSuffix || '');\n    }\n\n    titleElement.setAttribute('content', titleStr);\n    ogTitleElement.setAttribute('content', titleStr);\n    this.titleService.setTitle(titleStr);\n  }\n\n  setTag(tag: string, value: any) {\n    if (tag === 'title' || tag === 'titleSuffix') {\n      throw new Error(`Attempt to set ${tag} through 'setTag': 'title' and 'titleSuffix' are reserved tag names. Please use 'MetaService.setTitle' instead`);\n    }\n    const tagElement = this._getOrCreateMetaTag(tag);\n    let tagStr = isDefined(value) ? value : (this.metaConfig.defaults[tag] || '');\n    tagElement.setAttribute('content', tagStr);\n    if (tag === 'description') {\n      let ogDescElement = this._getOrCreateMetaTag('og:description');\n      ogDescElement.setAttribute('content', tagStr);\n    }\n  }\n\n}\n"]}