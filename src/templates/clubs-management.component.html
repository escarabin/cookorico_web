<ul>
    <li class="row"
        *ngFor="let club of clubs; let i = index">
        <div class="col-md-2 col-sm-2 hidden-xs">
            <img src="{{ club.profilePictureUrl }}"
                 *ngIf="club.profilePictureUrl"
                 class="full-width"/>
        </div>
        <div class="col-md-4">
            <h3>{{ club.username }}</h3>
            <span class="fa fa-user"></span> &nbsp; {{ club.firstName }} {{ club.lastName }}<br />
            <span *ngIf="club.phone">
                <span class="fa fa-phone"></span> &nbsp; {{ club.phone }}<br />
            </span>
            <span class="fa fa-envelope"></span> &nbsp; {{ club.email }}
        </div>
        <div class="col-md-3 centered">
            <br />
            <button class="btn btn-default"
                    (click)="loginUsingId(club.id)">
                Accéder
            </button>
            <br />
            <button class="btn btn-primary"
                    routerLink="/club/{{ club.id }}">
                Page emploi
            </button>
        </div>
        <div class="col-md-3 centered">
            <br />
            <button class="btn btn-warning"
                    (click)="deleteClub(club.id)">
                Supprimer ce
                <span *ngIf="!isGroupEdtingMode">club</span>
                <span *ngIf="isGroupEdtingMode">groupe</span>
            </button>
            <button class="btn btn-success"
                    (click)="editClub(club)">
                Modifier ce
                <span *ngIf="!isGroupEdtingMode">club</span>
                <span *ngIf="isGroupEdtingMode">groupe</span>
            </button>
        </div>
        <div class="col-md-12">
            <hr />
            <div class="col-md-12 centered">
                <button type="button" class="btn btn-default"
                        (click)="isBusinessesCollapsed[i] = !isBusinessesCollapsed[i]">
                    + Ajouter un établissement
                </button>
                <br />
                <br />
                <div [collapse]="!isBusinessesCollapsed[i]"
                     class="card card-block card-header">
                    <div class="col-md-12">
                        <business-select [isRequired]="true"
                                         (businessIdChange)="handleBusinessIdChange($event, club.id)">

                        </business-select>
                    </div>
                    <div class="col-md-10">
                        <br />
                        <label>ID de l'établissement</label>
                        <input type="text"
                               [(ngModel)]="businessIdList[i]"
                               ngControl="businessIdList[i]"
                               class="form-control"
                               placeholder="ID de l'établissement"/>
                    </div>
                    <div class="col-md-2">
                        <br/>
                        <br/>
                        <button class="btn btn-primary"
                                (click)="handleBusinessIdChange(businessIdList[i], club.id)">
                            Ajouter
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-12 centered">
                    <button type="button" class="btn btn-default"
                            (click)="isMemberCollapsed[i] = !isMemberCollapsed[i]">
                        Membres
                    </button>
                </div>
                <br />
                <br />
                <div [collapse]="!isMemberCollapsed[i]"
                     class="card card-block card-header">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Prénom</th>
                            <th>Email</th>
                            <th>Rôle</th>
                            <th>Suppr.</th>
                        </tr> </thead>
                        <tbody>
                            <tr>
                                <td>{{ club.lastName }}</td>
                                <td>{{ club.firstName }}</td>
                                <td>{{ club.email }}</td>
                                <td>Admin</td>
                                <td>
                                    <button class="btn btn-default full-width" disabled>
                                        <span class="icon-trash"></span>
                                    </button>
                                </td>
                            </tr>
                            <tr *ngFor="let member of club.club_members">
                                <td>{{ member.lastName }}</td>
                                <td>{{ member.firstName }}</td>
                                <td>{{ member.email }}</td>
                                <td *ngIf="!member.is_admin">Utilisateur</td>
                                <td *ngIf="member.is_admin">Admin</td>
                                <td>
                                    <button class="btn btn-default full-width"
                                            (click)="deleteClubMember(member.id)">
                                        <span class="icon-trash"></span>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="col-md-6">
                        <label>Prénom</label>
                        <input type="text"
                               [(ngModel)]="newClubMember['firstName']"
                               ngControl="newClubMemberList['firstName']"
                               class="form-control"
                               placeholder="Prénom"/>
                    </div>
                    <div class="col-md-6">
                        <label>Nom</label>
                        <input type="text"
                               [(ngModel)]="newClubMember['lastName']"
                               ngControl="newClubMemberList['lastName']"
                               class="form-control"
                               placeholder="Nom"/>
                    </div>
                    <div class="col-md-6">
                        <label>Email</label>
                        <input type="text"
                               [(ngModel)]="newClubMember['email']"
                               ngControl="newClubMemberList['email']"
                               class="form-control"
                               placeholder="Email"/>
                    </div>
                    <div class="col-md-6">
                        <label>Mot de passe</label>
                        <input type="password"
                               [(ngModel)]="newClubMember['password']"
                               ngControl="newClubMemberList['password']"
                               class="form-control"
                               placeholder="Mot de passe"/>
                    </div>
                    <div class="col-md-12 centered">
                        <label>
                            Administrateur
                            <input type="checkbox"
                                   [(ngModel)]="newClubMember['isAdmin']"
                                   ngControl="newClubMemberList['isAdmin']"/>
                        </label>
                    </div>
                    <div class="col-md-12 centered">
                        <button class="btn btn-primary"
                                (click)="createClubMember(club.id)">
                            Créer membre
                        </button>
                        <br /><br />
                    </div>
                </div>
            </div>
            <div class="col-md-12" style="border-top: 1px solid #CCC">
                <ul>
                    <li *ngFor="let business of club.businesses"
                        class="row business">
                        <div class="col-md-2 col-sm-2 hidden-xs logo-container" *ngIf="business.logo">
                            <img src="{{ business.logo }}"
                                 class="full-width"/>
                        </div>
                        <div [class.col-md-8]="business.logo"
                             [class.col-md-10]="!business.logo"
                             [class.col-sm-8]="business.logo"
                             [class.col-sm-10]="!business.logo"
                             class="col-xs-10">
                            <h3>{{ business.title }}</h3>
                            <span *ngIf="business.place && business.place.adress">
                                <b>{{ business.place.adress }}</b>
                            </span><br />
                            <span *ngIf="business.place && business.place.city">
                                {{ business.place.city }}
                            </span>
                        </div>
                        <div class="col-md-2">
                            <br />
                            <button class="btn btn-default"
                                    (click)="detachBusinessFromClub(club.id, business.id)">
                                Détacher
                            </button>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </li>
</ul>

<div class="row create-club">
    <form #createClubForm="ngForm">
        <div class="col-md-12 centered">
            <h2>
                <span *ngIf="!club.id">Créer</span> <span *ngIf="club.id">Modifier</span> un <span *ngIf="!isGroupEdtingMode">club</span>
                <span *ngIf="isGroupEdtingMode">groupe</span>
            </h2>
            <br />
            <button class="btn btn-default"
                    *ngIf="club.id"
                    (click)="club = {'plans': [{}]}">
                Créer un nouveau groupe
            </button>
            <br />
            <br />
        </div>
        <div class="col-md-6">
            <input type="text"
                   required
                   [(ngModel)]="club.username"
                   ngControl="club.username"
                   name="username"
                   placeholder="Nom"
                   class="form-control"/>
        </div>
        <div class="col-md-6">
            <input type="text"
                   class="form-control"
                   required
                   name="place"
                   placeholder="Lieu"
                   (setAddress)="parseAdress($event)"
                   googleplace/>
        </div>
        <div class="col-md-6 centered">
            <div ng2FileDrop
                 [ngClass]="{'nv-file-over': hasBaseDropZoneOver}"
                 (fileOver)="fileOverBase($event)"
                 (onFileDrop)="resumeFileDropped($event)"
                 [uploader]="resumeUploader"
                 class="well file-drop-zone">
                Déposez votre fichier ici
            </div>

            <input type="file"
                   ng2FileSelect
                   [uploader]="resumeUploader"
                   (change)="fileChangeListener($event)"/>
            <span class="cropping-result" *ngIf="profilePictureData.image" >
                <h3>Ceci sera le logo</h3><br />
                <img [src]="profilePictureData.image"
                     [width]="cropperSettings.croppedWidth"
                     [height]="cropperSettings.croppedHeight">
            </span>
        </div>
        <div class="col-md-6">
            <img-cropper #cropper [image]="profilePictureData" [settings]="cropperSettings">

            </img-cropper>
        </div>
        <div class="col-md-12 centered">
            <h3>
                Contact du <span *ngIf="!isGroupEdtingMode">club</span>
                <span *ngIf="isGroupEdtingMode">groupe</span>
            </h3>
        </div>
        <div class="col-md-6">
            <label>Email</label>
            <input type="text"
                   [(ngModel)]="club.email"
                   ngControl="club.email"
                   name="email"
                   required
                   placeholder="Email du contact"
                   class="form-control"/>
        </div>
        <div class="col-md-6">
            <label>Mot de passe</label>
            <input type="password"
                   [(ngModel)]="club.password"
                   ngControl="club.password"
                   name="password"
                   required
                   placeholder="Mot de passe du compte"
                   class="form-control"/>
        </div>
        <div class="col-md-6">
            <label>Nom</label>
            <input type="text"
                   [(ngModel)]="club.lastName"
                   ngControl="club.lastName"
                   name="lastName"
                   placeholder="Nom du contact"
                   class="form-control"/>
        </div>
        <div class="col-md-6">
            <label>Prénom</label>
            <input type="text"
                   [(ngModel)]="club.firstName"
                   ngControl="club.firstName"
                   name="firstName"
                   placeholder="Prénom du contact"
                   class="form-control"/>
        </div>
        <div class="col-md-6">
            <label>Téléphone</label>
            <input type="text"
                   [(ngModel)]="club.phone"
                   ngControl="club.phone"
                   name="phone"
                   placeholder="Téléphone du contact"
                   class="form-control"/>
        </div>
        <div class="col-md-6"
             *ngIf="club.plans">
            <label>Emplacements</label>
            <input type="number"
                   [(ngModel)]="club.plans[0].spaces"
                   ngControl="club.plans[0].spaces"
                   name="groupSpacesAmount"
                   placeholder="Emplacements"
                   class="form-control"/>
        </div>
        <div class="col-md-6"
             *ngIf="club.plans">
            <label>Contacts</label>
            <input type="number"
                   [(ngModel)]="club.plans[0].daily_contacts"
                   ngControl="club.plans[0].daily_contacts"
                   name="groupDailyContactsAmount"
                   placeholder="Contacts"
                   class="form-control"/>
        </div>
        <div class="col-md-6"
             *ngIf="club.plans">
            <label>Date d'expiration</label>
            <input type="date"
                   [(ngModel)]="club.plans[0].ends_at"
                   ngControl="club.plans[0].ends_at"
                   name="groupPlanEndsAt"
                   placeholder="Date d'expiration"
                   class="form-control"/>
        </div>
        <div class="col-md-12 centered">
            <br />
            <button class="btn btn-default"
                    (click)="saveClub()"
                    [disabled]="isSavingClub || !createClubForm.valid">
                Enregistrer <span class="fa fa-spinner fa-spin" *ngIf="isSavingClub"></span>
            </button>
        </div>
    </form>
</div>

<div bsModal
     #clubContactModal="bs-modal"
     id="club-contact-modal"
     class="modal fade in"
     tabindex="-1"
     role="dialog"
     aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-body">
                <div class="col-md-6">
                    <label>Email</label>
                    <input type="text"
                           [(ngModel)]="club.email"
                           ngControl="club.email"
                           name="email"
                           required
                           placeholder="Email du contact"
                           class="form-control"/>
                </div>
                <div class="col-md-6"
                     *ngIf="club.id">
                    <label>Mot de passe</label>
                    <input type="password"
                           [(ngModel)]="club.password"
                           ngControl="club.password"
                           name="password"
                           placeholder="Mot de passe du compte"
                           class="form-control"/>
                </div>
                <div class="col-md-6">
                    <label>Nom</label>
                    <input type="text"
                           [(ngModel)]="club.lastName"
                           ngControl="club.lastName"
                           name="lastName"
                           placeholder="Nom du contact"
                           class="form-control"/>
                </div>
                <div class="col-md-6">
                    <label>Prénom</label>
                    <input type="text"
                           [(ngModel)]="club.firstName"
                           ngControl="club.firstName"
                           name="firstName"
                           placeholder="Prénom du contact"
                           class="form-control"/>
                </div>
                <div class="col-md-6">
                    <label>Téléphone</label>
                    <input type="text"
                           [(ngModel)]="club.phone"
                           ngControl="club.phone"
                           name="phone"
                           placeholder="Téléphone du contact"
                           class="form-control"/>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- TODO : this is a workaround, we have to change it in near future -->
<div id="modal-backdrop-replacement"
     style="background: rgba(0,0,0,0.7);
             position: fixed;
             display: none;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             z-index: 10;">

</div>