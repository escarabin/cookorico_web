<div class="col-md-12 header-container">
    <div class="col-md-12 col-sm-12 col-xs-11 items-count" style="color: black">
        Créer un nouvel abonnement
    </div>
</div>

<div class="col-md-12" style="margin-top: 15px;">
    <div class="col-md-3">
        <label>Email</label>
        <input type="text"
               name="planEmail"
               [(ngModel)]="planEmail"
               ngControl="planEmail"
               class="form-control"
               placeholder="Email de l'établissement"/>
    </div>
    <div class="col-md-2">
        <label>Crédits</label>
        <input type="number"
               name="planCredits"
               [(ngModel)]="planCredits"
               ngControl="planCredits"
               [disabled]="planIsUnlimited"
               class="form-control"
               placeholder="Crédits"/>
    </div>
    <div class="col-md-2">
        <label>Contacts</label>
        <input type="number"
               class="form-control"
               name="planContacts"
               [(ngModel)]="planContacts"
               ngControl="planContacts"
               placeholder="Contacts"/>
    </div>
    <div class="col-md-2">
        <label>Emplacements</label>
        <input type="number"
               class="form-control"
               name="planSpaces"
               [(ngModel)]="planSpaces"
               ngControl="planSpaces"
               placeholder="Emplacements"/>
    </div>
    <div class="col-md-2">
        <label>Remonter annonce</label>
        <input type="number"
               class="form-control"
               name="planPullUpPost"
               [(ngModel)]="planPullUpPost"
               ngControl="planPullUpPost"
               placeholder="Remonter annonce"/>
    </div>
    <div class="col-md-1">
        <label>Illimité</label>
        <input type="checkbox"
               [(ngModel)]="planIsUnlimited"
               ngControl="planIsUnlimited"/>
    </div>
    <div class="col-md-4 col-md-offset-4">
        <label>Date de fin</label>
        <input type="date"
               [(ngModel)]="planEndsAt"
               ngControl="planEndsAt"
               [disabled]="!planIsUnlimited"
               name="planEndsAt"
               class="form-control"
               placeholder="Date de fin"/>
    </div>
    <div class="col-md-12">
        <br />
         <button class="btn btn-primary full-width"
                 (click)="createNewPlan()">
             <span class="fa fa-save"></span> &nbsp; Sauvegarder
         </button>
    </div>
</div>

<div class="col-md-12 header-container">
    <div class="col-md-12 col-sm-12 col-xs-11 items-count" style="color: black">
        {{ plans.length }} abonnements
    </div>
</div>

<div class="col-md-4">
    <hr />
    <input class="form-control full-width"
           type="text"
           [(ngModel)]="searchEmail"
           name="searchEmail"
           ngControl="searchEmail"
           placeholder="Rechercher par email"/>
    <hr />
</div>
<div class="col-md-3">
    <hr />
    <input class="form-control full-width"
           type="text"
           [(ngModel)]="searchName"
           name="searchName"
           ngControl="searchName"
           placeholder="Rechercher par nom"/>
    <hr />
</div>
<div class="col-md-3">
    <hr />
    <input class="form-control full-width"
           type="number"
           [(ngModel)]="searchId"
           name="searchId"
           ngControl="searchId"
           style="width: 100% !important;"
           placeholder="Rechercher par ID"/>
    <hr />
</div>
<div class="col-md-2">
    <br />
    <br />
    <button class="btn btn-primary full-width"
            (click)="search()">
        <span class="fa fa-search"></span> &nbsp; Rechercher
    </button>
</div>


<div class="col-md-12 list-container">
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Établissement</th>
            <th>Credits</th>
            <th>Emplac.</th>
            <th>Contacts</th>
            <th>Illimité</th>
            <th>Durée (mois)</th>
            <th>Sauv.</th>
            <th>Suppr.</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let plan of plans">
            <th scope="row">
                <div class="col-md-12 col-sm-12 col-xs-12 item" *ngIf="plan.business">
                    #{{ plan.business.id }}<br />
                    <span class="fa fa-home"></span> &nbsp; {{ plan.business.title }}<br />
                    <span class="fa fa-envelope"></span> &nbsp; {{ plan.business.email }}<br />
                </div>
                <div class="col-md-12 col-sm-12 col-xs-12 item" *ngIf="plan.user">
                    <span class="fa fa-user"></span> &nbsp; {{ plan.user.lastName }}<br />
                    <span class="fa fa-envelope"></span> &nbsp; {{ plan.user.email }}
                </div>
            </th>
            <td>
                <input type="number"
                       class="form-control"
                       [(ngModel)]="plan.credits"
                       ngControl="plan.credits"
                       name="planCredits"
                       [disabled]="plan.is_unlimited"
                       [class.disabled]="plan.is_unlimited"
                       value="{{ plan.credits }}"
                       placeholder="Crédits"/>
            </td>
            <td>
                <input type="number"
                       [(ngModel)]="plan.spaces"
                       ngControl="plan.spaces"
                       name="planSpaces"
                       class="form-control"
                       value="{{ plan.spaces }}"
                       placeholder="Emplacements"/>
            </td>
            <td>
                <input type="number"
                       [(ngModel)]="plan.daily_contacts"
                       ngControl="plan.daily_contacts"
                       name="listPlanDailyContacts"
                       class="form-control"
                       value="{{ plan.daily_contacts }}"
                       placeholder="Contacts"/>
            </td>
            <td>
                <input type="checkbox"
                       [(ngModel)]="plan.is_unlimited"
                       ngControl="plan.is_unlimited"
                       name="listPlanIsUnlimited"
                       [checked]="plan.is_unlimited"/>
                <span *ngIf="plan.ends_at">
                    <input type="text"
                           style="width: 200px;"
                           value="{{ plan.ends_at }}"
                           class="form-control"
                           placeholder="Date de fin"/>
                </span>
                <input type="date"
                       *ngIf="!plan.ends_at"
                       [(ngModel)]="plan.ends_at"
                       ngControl="plan.ends_at"
                       [disabled]="!plan.is_unlimited"
                       value="{{ plan.ends_at }}"
                       name="listPlanUnlimitedEndsAt"
                       class="form-control"
                       placeholder="Date de fin"/>
            </td>
            <td>
                <input type="number"
                       class="form-control"
                       [disabled]="plan.credits != -1"
                       [(ngModel)]="plan.duration"
                       ngControl="plan.duration"
                       name="listPlanDuration"
                       [class.disabled]="plan.credits != -1"
                       value="{{ plan.duration }}"
                       placeholder="Durée (mois)"/>
            </td>
            <td>
                <button class="btn btn-default"
                        (click)="updatePlan(plan.id, plan.credits, plan.daily_contacts, plan.spaces, plan.pull_up_credits, plan.duration, plan.is_unlimited, plan.ends_at)">
                    <span class="fa fa-save"></span>
                </button>
            </td>
            <td>
                <button class="btn btn-danger"
                        (click)="deletePlan(plan.id)">
                    <span class="fa fa-trash"></span>
                </button>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div class="col-md-12 list-container">
    <ul>
        <li class="row" *ngFor="let plan of plans | paginate: { itemsPerPage: 20, currentPage: p }">
            <div class="col-md-12 col-sm-12 col-xs-12 item" *ngIf="plan.business">
                {{ plan.business.title }}
            </div>
        </li>
    </ul>

    <pagination-controls #pagination (pageChange)="p = $event" (click)="pageChanged()">
        <!-- <custom-pagination [pagination]="pagination"></custom-pagination>-->
    </pagination-controls>
</div>