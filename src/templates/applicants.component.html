<h2 class="centered" *ngIf="filteredApplicants.length > 0">{{ filteredApplicants.length }} postulants</h2>
<hr />

<div class="col-md-12">
    <select class="form-control"
            [(ngModel)]="businessId"
            (change)="filterApplicants()"
            ngControl="businessId">
        <option value="0">
            -- Sélectionnez un établissement --
        </option>
        <option *ngFor="let business of userBusinesses"
                value="{{ business.id }}">
            {{ business.title }}
        </option>
    </select>
    <br />
</div>

<!-- Multi businesses -->
<div *ngIf="userBusinesses.length > 1 && businessId != 0">
   <div *ngFor="let business of userBusinesses">
        <div *ngIf="business.id == businessId || businessId == 0">
            <span *ngIf="business.jobs.length == 0">
                Aucune offre d'emploi pour cet établissement
            </span>
            <label>Sélectionnez une offre d'emploi</label>
            <select class="form-control"
                    ngControl="jobPostId"
                    *ngIf="business.jobs.length > 0"
                    (change)="filterApplicants()"
                    [(ngModel)]="jobPostId">
                <option value="0">-- Sélectionnez une offre d'emploi --</option>
                <option *ngFor="let jobPost of business.jobs"
                        value="{{ jobPost.id }}">
                    REF{{ jobPost.id }} {{ jobPost.job_naming.title }} - {{ jobPost.business.title }} ({{ jobPost.applications.length }})
                </option>
            </select>
        </div>
    </div>
</div>

<!-- Single business -->
<div *ngIf="userBusinesses.length == 1">
    <label>Sélectionnez une offre d'emploi</label>
    <select class="form-control"
            ngControl="jobPostId"
            (change)="filterApplicants()"
            [(ngModel)]="jobPostId">
        <option value="0">-- Sélectionnez une offre d'emploi --</option>
        <option *ngFor="let jobPost of jobPosts"
                value="{{ jobPost.id }}">
            REF{{ jobPost.id }} {{ jobPost.job_naming.title }} - {{ jobPost.business.title }} ({{ jobPost.applications.length }})
        </option>
    </select>
</div>

<hr />
<div class="col-md-12 list-container">
    <div class="col-md-6 col-md-offset-3"
         *ngIf="items.length == 0 && jobPostId">
        <br /><br />
        <div class="alert alert-warning alert-dismissible fade in" role="alert">
            <strong>Aucun candidat pour le moment sur cette offre</strong>
        </div>
        <br /><br />
    </div>
    <ul>
        <div *ngFor="let item of filteredApplicants">
            <li class="row">
                <div class="col-md-12 col-sm-12 col-xs-11 item"
                     [class.photo]="item.user.profilePictureUrl">
                    <div class="col-md-2">
                        <img src="{{ item.user.profilePictureUrl }}"/>
                    </div>
                    <div class="col-md-4">
                        <h3>{{ item.user.firstName }}</h3>
                        <span *ngIf="item.user.xpLevel">
                             {{ item.user.xpLevel.title }}<br />
                        </span>
                        <span *ngIf="item.user.languages.length > 0">
                            Langues parlées :
                            <span *ngFor="let language of item.user.languages">
                                {{ language.title }},
                            </span>
                            <br />
                        </span>
                        <strong *ngIf="item.job">{{ item.job.title }}</strong><br />
                        <span class="date">
                            <span class="fa fa-clock-o"></span>
                            A postulé le {{ item.created_at | date:"dd/MM/yyyy" }}
                        </span>
                    </div>
                    <div class="col-md-2" *ngIf="!item.is_interested">
                        <button class="btn btn-primary full-width"
                                [disabled]="item.is_interested || item.is_rejected"
                                (click)="acceptApplication(item.id)"
                                tooltipPlacement="bottom" tooltipHtml="{{ item.acceptedTemplate }}">
                            <span class="icon-envelope-letter"></span><br />
                            Intéressé
                        </button>
                    </div>
                    <div class="col-md-2" *ngIf="!item.is_interested">
                        <button class="btn btn-danger full-width"
                                [disabled]="item.is_interested || item.is_rejected"
                                (click)="rejectApplication(item.id)"
                                tooltipPlacement="bottom" tooltipHtml="{{ item.rejectedTemplate }}">
                            <span class="icon-envelope-letter"></span><br />
                            Refuser
                        </button>
                    </div>
                    <div class="col-md-4 centered" *ngIf="item.is_interested">
                        <br />
                        <strong>Ce profil vous intéresse</strong>
                    </div>
                    <div class="col-md-2">
                        <a routerLink="/profil/apercu/{{ item.user.id }}/complet">
                            <button class="btn btn-default full-width">
                                <span class="icon-eye"></span><br />
                                Voir
                            </button>
                        </a>
                    </div>
                </div>
            </li>
        </div>
    </ul>
</div>